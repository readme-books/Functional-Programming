### \# chapter 16

## \' 타임라인 사이에 자원 공유하기 \'

- 자원을 공유해서 생기는 버그를 찾는 방법
- 안전하게 자원을 공유할 수 있는 자원 공유 기본형(`동시성 기본형`)을 만드는 방법<br><br>


<hr>


## 좋은 타임라인의 원칙
1. 타임라인은 적을수록 이해하기 쉬움
    - 타임라인이 하나라면 모든 액션은 앞의 액션 다음에 실행됨
    - 멀티스레드나 비동기 콜백, 클라이언트-서버 간 통신을 사용하려면 새로운 타임라인이 필요
2. 타임라인은 짧을수록 이해하기 쉬움
    - 타임라인의 단계를 줄이면 실행 가능한 순서의 수도 많이 줄일 수 있음
3. 공유하는 자원이 적을수록 이해하기 쉬움
    - 서로 다른 타임라인에 있는 액션이 자원을 공유하지 않는다면 실행 순서가 상관 없어짐
    - 실행 가능한 순서의 개수가 줄어들지 않지만, 신경 써야할 실행 가능한 순서를 줄일 수 있음
4. 자원을 공유한다면 서로 조율해야 함
    - 공유 자원을 안전하게 공유(올바른 순서대로 자원을 쓰고 돌려줌)할 수 있어야 함
    - 타임라인 간 조율은 올바른 결과를 주지 않는 실행 순서를 없애는 것
5. 시간을 일급으로 다룸
    - 액션의 순서와 타이밍을 맞추는 것은 어렵지만 타임라인을 다루는 재사용 가능한 객체를 만들면 타이밍을 맞추기 쉬워짐

### 16 챕터 -> 좋은 타임라인 원칙 4

<br>


## 자바스크립트에서 큐 만들기
- 타임라인 조율에 자료구조인 큐를 사용하면 동시성 기본형(concurrency primitive)이라고 함
- 자바스크립트는 동시성 기본형을 제공하지 않기 때문에 만들어야 함
- Queue() : 액션에 순서를 보장해주는 도구
- 우선 클릭 핸들러에서 처리할 일과 큐에서 처리할 일을 구분(클릭 핸들러는 순서가 섞일 염려가 없기 때문에 가능한 많은 작업을 하도록 하는게 좋음)
- 큐에서 처리할 작업을 큐에 넣는 액션 하나로 변경
- 작업을 실행하려면 큐 가장 앞에 있는 항목을 꺼내면 됨
- 한 번에 작업이 하나만 실행되도록(타임라인이 섞이지 않도록) 이미 실행되는 작업이 있는지 확인할 수 있는 flag 변수 처리
- flag 변수로 작업 완료가 확인되면 다음 작업을 시작할 수 있도록 반복 구조로 콜백 함수 고치기
- 큐 안에 작업이 없으면 멈추도록 조건문 추가
- 큐를 재사용할 수 있도록 done()함수 빼내고 특정 동작이 아닌 큐가 생성될 때 원하는 행동을 전달할 수 있도록 함수를 인자로 빼기
- DroppingQueue()함수로 리팩토링하여 DOM 업데이트와 같은 최종 한번만 실행되어도 되는 작업을 중간 요청은 건너뛰도록 하여 속도를 개선한다 


<br>
<hr>

` 🔍 용어 정리 `
- `큐(queue)` : 넣은 순서대로 항목을 꺼낼 수 있는 데이터 구조
- `동시성 기본형(concurrency primitive)` : 자원을 안전하게 공유할 수 있는 재사용 가능한 코드
<hr>