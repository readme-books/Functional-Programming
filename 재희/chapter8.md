### \# chapter 8

## \' 계층형 설계 stratified design \'

- 소프트웨어 설계에 대한 실용적인 정의 <br>
- 깨끗한 코드를 위해 함수를 추출하는 방법<br>
- 계층을 나눠서 소프트웨어를 설계할 때의 장점<br>
- 바로 아래 계층의 함수로 지금 계층의 함수를 만드는 `계층형 설계` 알아보기<br><br>

<hr>

## 소프트웨어 설계
코드를 만들고, 테스트하고, 유지보수하기 쉬운 프로그래밍 방법을 선택하기 위해 미적 감각을 사용하는 것<br><br>


## 계층형 설계
소프트웨어를 계층으로 구성하는 기술<br>
각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의함<br>


### 계층형 설계 감각을 키우기 위한 `입력`
`함수 본문`
- 길이
- 복잡성
- 구체화 단계
- 함수 호출
- 프로그래밍 언어의 기능 사용

`계층 구조`
- 화살표 길이
- 응집도
- 구체화 단계

`함수 시그니처`
- 함수명
- 인자 이름
- 인잣값
- 리턴값


### 계층형 설계 감각을 키우기 위한 `출력`
`조직화`
- 새로운 함수를 어디에 놓을지 결정
- 함수를 다른 곳으로 이동

`구현`
- 구현 바꾸기
- 함수 추출하기
- 데이터 구조 바꾸기

`변경`
- 새 코드를 작성할 곳 선택하기
- 적절한 수준의 구체화 단계 결정하기

<br>


## 계층형 설계 패턴
1. 직접구현 : 직접 구현된 함수를 읽을 때, 함수 시그니처가 나타내고 있는 문제를 함수 본문에서 적절한 구체화 수준에서 해결해야 함
2. 추상화 벽 : 어떤 계층은 중요한 세부 구현을 감추고 인터페이스를 제공함으로써 고수준의 추상화 단계만 생각하여 두뇌 용량의 한계를 극복함
3. 작은 인터페이스 : 시스템이 커질수록 비즈니스 개념을 나타내는 중요한 인터페이스는 작고 강력한 동작으로 구성해야 좋음
4. 편리한 계층 : 개발자의 요구를 만족시키면서 비즈니스를 잘 풀 수 있도록 소프트웨어를 더 빠르고 고품질로 제공하는데 도움이 되는 계층에 시간을 투자해야 함, 이런 코드가 속한 추상화 계층은 작업할 때 편리해야 함


### 직접 구현 패턴이란❓
- 설계 원칙을 가지지 않은 코드는 유지보수하기 어려움, 구체화 단계가 다르기 때문
- 함수 시그니처, 본문, 호출 그래프와 같은 다양한 단서를 가지고 직접 구현 패턴 적용 가능
  - 함수 이름은 의도를 알려주기 때문에 비슷한 목적의 이름을 가진 함수를 함께 묶을 수 있음, 함수가 어느 곳에 위치할지 결정하기 위한 정보로 사용
  - 호출 그래프에서 함수 내부가 같은 단계를 바라보고 있다면 같은 계층에 있어도 좋다는 정보
- 저수준의 반복문과 같은 코드는 추출하여 함수화하기
- 함수 구현 시 어떤 구체화 단계로 사용할지 결정하는 것이 중요, 그래야 함수가 어떤 계층에 속할지 알 수 있음
- 함수가 알아야 할 필요가 없는 구체적인 내용은 알지 못하도록 일반적인 함수로 추출하여 대입하도록 구현하기
  - 일반적인 함수는 보통 구체적인 내용을 하나만 다루기 때문에 테스트하기 쉬움
  - 일반적인 함수가 많을수록 재사용하기 좋음
  - '중복 코드'를 찾기 위해 빼내는 것이 아닌 구현을 명확하게 하기 위해 빼내는 것
  - 일반적인 함수는 구체적인 함수보다 재사용성이 뛰어남
  - 명확하지 않은 코드를 감추기 위한 '도우미 함수'를 만드는 것이 아닌 더 낮은 구체화 수준을 가진 일반적인 함수를 만들기
- 호출 그래프(ex. 다이어그램)를 만들어 같은 추상화 수준의 단계별로 함수 호출을 시각화하기
  - 한 함수에서 서로 다른 추상화 단계를 사용하면 코드가 명확하지 않아 읽기 어려움
  - 같은 추상화 단계의 기능을 사용하는 직접 구현 패턴을 적용하기
- 계층이 서로 구분되는 목적이 있다면, 계층의 목적은 각 계층에 있는 함수의 목적과 같음
- 화살표 길이를 줄이는 것도 좋은 계층 구조를 만들 수 있음
    - 함수가 가리키는 화살표의 길이를 비교하는 것은 복잡성을 측정하는 좋은 방법이지만, 바꾼 후에도 여전히 서로 다른 두 계층을 바라본다면 긴 화살표를 하나 없애 설계를 개선한 것에 초점을 맞춰보기


### 계층형 설계의 문제점 찾는 방법 : 줌 레벨
1. 전역(기본) 줌 레벨
    - 호출 그래프 전체 중 필요한 부분을 살펴볼 수 있음
    - 계층 사이에 상호 관계를 포함해 모든 문제 영역을 살펴볼 수 있음
2. 계층 줌 레벨
    - 한 계층과 연결된 바로 아래 계층을 볼 수 있는 줌 레벨
    - 계층이 어떻게 구현되어 있는지 알 수 있음
    - 함수가 가리키는 화살표를 계층 간에 비교할 수 있음
3. 함수 줌 레벨
    - 함수 하나와 바로 아래 연결된 함수들을 볼 수 있음
    - 함수 구현의 문제를 찾을 수 있음
    - 함수 하나가 가진 화살표를 비교할 수 있음

<br>



<hr>

` 🔍 용어 정리 `
- `오브 바이 원(off-by-one) 에러` : 주로 배열을 반복해서 처리할 때 '크다' 또는 '크거나 같다'와 같은 비교문을 잘못 선택해 의도하지 않게 마지막 항목을 처리하지 못하거나 처리하는 오류를 말함

<hr>