## Chapter 7

라이브러리나 레거시 코드가 데이터를 변경하는 상황에서 불변성을 지키는 방법에 대해 알아본다

- 방어적 복사: 원본이 바뀌는 것을 막아준다.
    - 규칙1: 데이터가 안전한 코드에서 나갈 때 복사
    - 규칙2: 안전한 코드로 데이터가 들어올 때 복사
    - 데이터를 전달하기 전, 후에 **깊은 복사**를 하여 불변성을 유지한다.
    - 방어적 복사 부분 코드를 분리하여 새로운 함수로 만들어서 필요할 때 안전하게 쓸 수 있도록 구현한다.  코드가 하는 일이 더 명확해 진다. → 재사용성 증가, 가독성 증가

|  | 카피-온-라이트 | 방어적 복사 |
| --- | --- | --- |
| 언제 | 통제할 수 있는 데이터를 바꿀 때 사용 | 신뢰할 수 없는 코드와 데이터를 주고받아야 할 때 사용 |
| 어디서 | 안전지대 어디서나 사용 | 안전지대의 경계에서 데이터가 오고 갈 때 사용 |
| 복사 방식 | 앝은 복사(상대적으로 비용이 적게 듦) | 깊은 복사(상대적으로 비용이 많이 듦) |
| 규칙 | 1. 바꿀 데이터의 얕은 복사를 만든다.<br/>2. 복사본을 변경한다.<br/>3. 복사본을 리턴한다. | 1. 안전지대로 들어오는 데이터에 깊은 복사를 만든다.<br/>2. 안전지대에서 나가는 데이터에 깊은 복사를 만든다. |
- 자바스크립트에서는 Lodash의 .cloneDeep() 함수를 사용하여 깊은 복사를 하기를 추천한다.
